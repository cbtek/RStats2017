/*
    UIRStatsWorkbook.cpp
    

*/
//UIRStatsWorkbook.cpp generated by CBTek Solutions on 02-02-2017 at 12:51:01 AM

#include "UIRStatsWorkbook.h"
#include "ui_UIRStatsWorkbook.h"

#include "UIRStatsUtils.hpp"

namespace oig {
namespace ratstats {
namespace ui {

using namespace oig::ratstats::utils;

UIRStatsWorkbook::UIRStatsWorkbook(QWidget *parent) : QWidget(parent),m_ui(new Ui_UIRStatsWorkbook)
{
    m_ui->setupUi(this);
}

UIRStatsWorkbook::UIRStatsWorkbook(const RStatsWorkbook &workbook, QWidget *parent): QWidget(parent),m_ui(new Ui_UIRStatsWorkbook)
{
    m_ui->setupUi(this);
    setWorkbook(workbook);
}

void UIRStatsWorkbook::setWorkbook(const RStatsWorkbook &workbook)
{
    QList<int> sizes;
    sizes << 100 << 700;
    m_ui->splitter->setSizes(sizes);

    m_workbook = workbook;
    std::vector<std::string> names = m_workbook.getWorksheetNames();
    for(const std::string& name : names)
    {
        m_ui->m_lstWorksheets->addItem(QString::fromStdString(name));
    }
    if (m_ui->m_lstWorksheets->count())
    {
        m_ui->m_lstWorksheets->setCurrentRow(0);
        onSheetSelected(0);
    }
    connect(m_ui->m_lstWorksheets,SIGNAL(currentRowChanged(int)),this,SLOT(onSheetSelected(int)));
}

RStatsWorksheet UIRStatsWorkbook::getCurrentSheet() const
{
    return m_currentSheet;
}


UIRStatsWorkbook::~UIRStatsWorkbook()
{
    delete m_ui;
}

void UIRStatsWorkbook::onPopulateTable(const RStatsWorksheet &sheet)
{    
    m_currentSheet = sheet;
    UIRStatsUtils::bindSheetToUI(sheet,m_ui->m_tblCurrentSheet,false,0,0);
    emit sheetSelected(sheet);
    emit sheetSelected(m_ui->m_tblCurrentSheet);
}

void UIRStatsWorkbook::onSheetSelected(int index)
{
    if (index >=0 && index < m_workbook.getNumWorksheets())
    {
        onPopulateTable(m_workbook(index));
        onResizeToContents();
        onStretchToContents();
    }
}


void UIRStatsWorkbook::onResizeToContents()
{

//    if (m_ui->m_tblCurrentSheet->columnCount() > 0)
//    {
//        m_ui->m_tblCurrentSheet->horizontalHeader()->setSectionResizeMode(m_ui->m_tblCurrentSheet->columnCount()-1,QHeaderView::ResizeToContents);
//    }

    m_ui->m_tblCurrentSheet->resizeColumnsToContents();
    m_ui->m_tblCurrentSheet->resizeRowsToContents();    
    //m_ui->m_tblCurrentSheet->horizontalHeader()->setSectionResizeMode(QHeaderView::Stretch);
    m_ui->m_tblCurrentSheet->update();
    this->update();
}

void UIRStatsWorkbook::onShowGridLines()
{
    m_ui->m_tblCurrentSheet->setGridStyle(Qt::SolidLine);
}

void UIRStatsWorkbook::onHideGridLines()
{
    m_ui->m_tblCurrentSheet->setGridStyle(Qt::NoPen);
}

void UIRStatsWorkbook::onStretchToContents()
{
    m_ui->m_tblCurrentSheet->horizontalHeader()->setSectionResizeMode(QHeaderView::Stretch);
}
}}}//end namespace

